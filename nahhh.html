<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Final Smashers - Cosmic Impact Explorer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap');

    body {
      font-family: 'Orbitron', sans-serif;
      background: radial-gradient(ellipse at bottom, #050e26 0%, #000014 100%);
      color: #cbd5e1;
      min-height: 100vh;
      margin: 0;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    a:focus-visible, button:focus-visible {
      outline: 2px solid #56d9f9;
      outline-offset: 2px;
    }

    .nav-link:hover {
      color: #56d9f9;
    }

    .text-glow {
      text-shadow: 0 0 6px #56d9f9;
    }

    .rounded-container {
      border-radius: 1rem;
      border: 1px solid #1e293b;
      background-color: rgba(8, 19, 42, 0.65);
      box-shadow: 0 0 15px rgb(8 25 56 / 0.75);
    }

    .learn-more-btn {
      background-color: #0a143e;
      padding: 0.5rem 1.75rem;
      border-radius: 0.5rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      cursor: pointer;
      color: white; /* Ensure text color is white */
      border: none; /* Ensure no default button border */
    }
    .learn-more-btn:hover {
      background-color: #1e40af;
      box-shadow: 0 0 10px #3b82f6;
    }

    .card {
      border-radius: 0.75rem;
      background-color: rgba(11, 23, 50, 0.45);
      border: 1px solid #2c3b62;
      box-shadow: 0 0 10px rgb(58 73 121 / 0.6);
      transition: transform 0.2s ease;
      position: relative;
      overflow: hidden;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 0 30px #3b82f6;
    }

    .scroll-hide::-webkit-scrollbar {
      display: none;
    }
    .scroll-hide {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }

    img {
      background-color: #14213d;
      border-radius: 0.75rem;
      width: 100%;
      height: auto;
      object-fit: contain;
      display: block;
    }

    /* Hide the second and third pages initially - this is the original behavior */
    #second-page,
    #third-page {
      display: none;
    }

    /* === NEW ASTEROID UNDER STUDY STYLES === */
    .new-asteroid-container {
      display: flex; /* Default display for this section */
      padding: 2rem 4rem;
      align-items: center;
      gap: 3rem;
      background-color: #091026;
      border-radius: 1rem;
      margin: 2rem 6rem;
      box-shadow: 0 0 20px rgba(255, 187, 51, 0.6);
      color: #ffbb33;
    }

    .new-asteroid-content {
      flex: 1;
    }

    .new-asteroid-content h1 {
      font-size: 3rem;
      font-weight: 900;
      letter-spacing: 2px;
      margin: 0 0 1rem 0;
      line-height: 1.1;
    }

    .new-asteroid-content h1 span {
      color: #f0f0f0;
    }

    .asteroid-id {
      font-weight: 700;
      font-size: 1.5rem;
      color: #a0e7e5;
      margin-bottom: 1rem;
    }

    .details p {
      font-size: 1.1rem;
      color: #a0e7e5;
      margin: 0.35rem 0;
    }

    .details p span {
      color: #f0f0f0;
      font-weight: 600;
    }

    .image-container {
      width: 300px;
      height: 300px;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 0 15px rgba(255, 187, 51, 0.5);
      background-color: #000;
      flex-shrink: 0;
    }

    .image-container img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    @media (max-width: 768px) {
      .new-asteroid-container {
        flex-direction: column;
        padding: 2rem;
        margin: 2rem;
      }
      .image-container {
        width: 100%;
        height: 200px;
      }
    }

    /* === HOVER OVERLAY ON SECOND PAGE CARDS === */
    .card-image-wrapper {
      position: relative;
      width: 100%;
      border-radius: 0.75rem;
      overflow: hidden;
    }

    .card-hover-overlay {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 100%;
      background-color: rgba(20, 30, 60, 0.65);
      display: flex;
      justify-content: center;
      align-items: center;
      opacity: 0;
      transition: opacity 0.3s ease;
      border-radius: 0.75rem;
      pointer-events: none;
    }

    .card:hover .card-hover-overlay {
      opacity: 1;
      pointer-events: auto;
    }

    .card-hover-btn {
      background-color: #3b82f6;
      color: white;
      font-weight: 600;
      padding: 0.5rem 1.5rem;
      border-radius: 1.5rem;
      box-shadow: 0 4px 8px rgba(59,130,246,0.6);
      cursor: pointer;
      font-size: 1rem;
      user-select: none;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      border: none;
    }
    .card-hover-btn:hover,
    .card-hover-btn:focus-visible {
      background-color: #2563eb;
      box-shadow: 0 6px 12px rgba(37,99,235,0.8);
      outline: none;
    }

    /* === THIRD PAGE STYLES === */
    #third-page {
      max-width: 1200px;
      margin: 2rem auto 4rem;
      padding: 2rem;
      /* This will be controlled by JS, so default to hidden */
      /* display: flex; */ /* Removed default flex to ensure JS controls it */
      align-items: center;
      gap: 4rem;
      color: white;
      border-radius: 1rem;
      background: rgba(5, 14, 38, 0.85);
      box-shadow: 0 0 20px #3b82f6;
      flex-wrap: wrap;
    }
    #third-page img {
      flex-shrink: 0;
      width: 400px;
      max-width: 100%;
      border-radius: 1rem;
      box-shadow: 0 0 25px #0ea5e9;
      background-color: #000;
    }
    #third-page-content {
      flex: 1 1 400px;
    }
    #third-page-content h1 {
      font-size: 3rem;
      font-weight: 900;
      margin-bottom: 1rem;
      line-height: 1.1;
    }
    #third-page-content h1 span {
      color: #fbbf24;
    }
    #third-page-content p {
      font-size: 1.2rem;
      line-height: 1.6;
      color: #d1d5db;
      white-space: pre-line; /* This is important for preserving newlines */
    }

    #third-page .back-btn {
      margin-top: 2rem;
      background-color: #3b82f6;
      border: none;
      border-radius: 0.5rem;
      padding: 0.75rem 2rem;
      color: white;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      cursor: pointer;
      box-shadow: 0 0 10px #3b82f6;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }
    #third-page .back-btn:hover,
    #third-page .back-btn:focus-visible {
      background-color: #2563eb;
      box-shadow: 0 0 15px #2563eb;
      outline: none;
    }

    /* Responsive third page */
    @media (max-width: 768px) {
      #third-page {
        flex-direction: column;
        padding: 1rem;
        margin: 1rem;
      }
      #third-page img {
        width: 100%;
        margin-bottom: 1.5rem;
      }
      #third-page-content h1 {
        font-size: 2.5rem;
      }
    }

    /* === CHATBOT STYLES === */
    #chatbot-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #56d9f9;
      color: #000014;
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 24px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      box-shadow: 0 0 15px rgba(86, 217, 249, 0.7);
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      z-index: 1000;
      /* Add jump animation */
      animation: jump 2s infinite ease-in-out;
    }
    #chatbot-btn:hover {
      background-color: #3b82f6;
      box-shadow: 0 0 20px rgba(59, 130, 246, 0.9);
    }

    /* Keyframe animation for jumping effect */
    @keyframes jump {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-10px); /* Adjust how high it jumps */
      }
    }

    #chatbot-modal {
      display: none; /* Corrected: Should start hidden */
      position: fixed;
      bottom: 90px;
      right: 20px;
      width: 320px;
      height: 450px;
      background: rgba(8, 19, 42, 0.95);
      border: 1px solid #1e293b;
      border-radius: 1rem;
      box-shadow: 0 0 25px rgba(86, 217, 249, 0.5);
      z-index: 999;
      flex-direction: column;
      overflow: hidden;
    }
    #chatbot-header {
      background: #0a143e;
      color: #56d9f9;
      padding: 12px;
      border-bottom: 1px solid #1e293b;
      text-align: center;
      font-weight: 700;
      font-size: 1.1rem;
      letter-spacing: 0.05em;
    }
    #chat-messages {
      flex-grow: 1;
      overflow-y: auto;
      padding: 15px;
      color: #cbd5e1;
      font-size: 0.95rem;
      line-height: 1.4;
      scrollbar-width: thin;
      scrollbar-color: #3b82f6 #0a143e;
    }
    #chat-messages::-webkit-scrollbar {
      width: 8px;
    }
    #chat-messages::-webkit-scrollbar-track {
      background: #0a143e;
    }
    #chat-messages::-webkit-scrollbar-thumb {
      background-color: #3b82f6;
      border-radius: 10px;
      border: 2px solid #0a143e;
    }

    .message {
      margin-bottom: 10px;
      padding: 10px 12px;
      border-radius: 0.75rem;
      max-width: 80%;
      word-wrap: break-word;
    }
    .user {
      background: #1e40af;
      color: white;
      margin-left: auto;
      text-align: right;
    }
    .bot {
      background: #050e26;
      border: 1px solid #1e293b;
      color: #cbd5e1;
      margin-right: auto;
      text-align: left;
    }
    #chat-input-container {
      display: flex;
      border-top: 1px solid #1e293b;
      background-color: #0a143e;
    }
    #chat-input {
      flex-grow: 1;
      padding: 12px 15px;
      border: none;
      background: transparent;
      color: #cbd5e1;
      font-size: 1rem;
    }
    #chat-input:focus {
      outline: none;
    }
    #chat-input::placeholder {
      color: #64748b;
    }
    #chat-send-btn {
      background-color: #3b82f6;
      color: white;
      border: none;
      padding: 0 15px;
      border-radius: 0 0 0.75rem 0;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    #chat-send-btn:hover {
      background-color: #2563eb;
    }

    /* Additional responsive adjustments for second page cards */
    @media (max-width: 768px) {
      #second-page-cards {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); /* Adjust for smaller screens */
      }
    }

    /* === GATE STYLES === */
    #gate-modal {
      display: none; /* Hidden by default */
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 2000; /* Above everything else */
      justify-content: center;
      align-items: center;
    }

    #gate-content {
      background: rgba(8, 19, 42, 0.95);
      border: 1px solid #1e293b;
      border-radius: 1rem;
      padding: 2rem;
      box-shadow: 0 0 30px rgba(86, 217, 249, 0.7);
      width: 90%;
      max-width: 450px;
      text-align: center;
      position: relative;
    }

    #gate-content h2 {
      font-size: 2rem;
      font-weight: 700;
      color: #56d9f9;
      margin-bottom: 1.5rem;
    }

    #gate-content input[type="text"],
    #gate-content input[type="password"],
    #gate-content select {
      width: calc(100% - 24px); /* Account for padding */
      padding: 12px;
      margin-bottom: 1rem;
      border: 1px solid #2c3b62;
      border-radius: 0.5rem;
      background-color: #050e26;
      color: #cbd5e1;
      font-size: 1rem;
    }

    #gate-content input[type="text"]:focus,
    #gate-content input[type="password"]:focus,
    #gate-content select:focus {
      outline: none;
      border-color: #56d9f9;
      box-shadow: 0 0 8px rgba(86, 217, 249, 0.5);
    }

    #gate-content button {
      width: 100%;
      padding: 12px;
      border-radius: 0.5rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      cursor: pointer;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      margin-top: 0.5rem;
    }

    #gate-content .primary-btn {
      background-color: #3b82f6;
      color: white;
      box-shadow: 0 0 10px #3b82f6;
    }
    #gate-content .primary-btn:hover {
      background-color: #2563eb;
      box-shadow: 0 0 15px #2563eb;
    }

    #gate-content .secondary-btn {
      background-color: #0a143e;
      color: #56d9f9;
      border: 1px solid #56d9f9;
      margin-top: 1rem;
    }
    #gate-content .secondary-btn:hover {
      background-color: #1e40af;
      box-shadow: 0 0 10px #56d9f9;
    }

    #gate-message {
      color: #ef4444; /* Red for errors */
      margin-top: 1rem;
      min-height: 1.5rem;
    }

    #login-toggle-btn, #signup-toggle-btn {
        background: none;
        border: none;
        color: #56d9f9;
        text-decoration: underline;
        cursor: pointer;
        font-size: 0.9rem;
        margin-top: 1rem;
    }
    #login-toggle-btn:hover, #signup-toggle-btn:hover {
        color: #3b82f6;
    }

    /* Hide main content until logged in */
    body.logged-out #main-content-wrapper {
        display: none;
    }
    body.logged-out #chatbot-btn {
        display: none; /* Hide chatbot if not logged in */
    }

    /* Header elements for logged in state */
    #user-info {
        display: flex;
        align-items: center;
        gap: 1rem;
        color: #cbd5e1;
        font-weight: 600;
    }
    #logout-btn {
        background-color: #ef4444; /* Red logout button */
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        font-weight: 700;
        transition: background-color 0.3s ease;
    }
    #logout-btn:hover {
        background-color: #dc2626;
    }
    #login-signup-btn {
        background-color: #56d9f9;
        color: #000014;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        font-weight: 700;
        transition: background-color 0.3s ease;
    }
    #login-signup-btn:hover {
        background-color: #3b82f6;
    }

    /* Scientist exclusive content */
    #scientist-exclusive-content {
        display: none; /* Hidden by default, JS will show if scientist is logged in */
        background-color: rgba(11, 23, 50, 0.6);
        border: 1px solid #2c3b62;
        border-radius: 1rem;
        margin: 2rem 6rem;
        padding: 2rem;
        box-shadow: 0 0 20px rgba(59, 130, 246, 0.6);
        color: #a0e7e5;
        text-align: center;
    }

    #scientist-exclusive-content h2 {
        font-size: 2.5rem;
        color: #56d9f9;
        margin-bottom: 1rem;
    }
    #scientist-exclusive-content p {
        font-size: 1.1rem;
        line-height: 1.6;
    }

    /* === EARTH PLANET EYE STYLES === */
    #earth-container {
      position: relative;
      width: 100px; /* Size of the Earth */
      height: 100px;
      margin: 0 auto 1.5rem auto; /* Center and add space below */
      border-radius: 50%;
      overflow: hidden; /* Crucial for containing the eyelid */
      box-shadow: 0 0 15px rgba(86, 217, 249, 0.5);
      background-color: #000; /* Fallback if image fails */
    }

    #earth-planet {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 50%;
      display: block;
    }

    #earth-eyelid {
      position: absolute;
      top: 0; /* Start at the top of the planet */
      left: 0;
      width: 100%;
      height: 100%; /* Covers the whole planet initially */
      background: radial-gradient(circle at 50% 20%, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.5) 50%, transparent 70%); /* Simulates a dark crescent */
      /* Or use an image: */
      /* background-image: url('https://example.com/path/to/your/crescent-eyelid.png'); */
      /* background-size: cover; */
      /* background-position: center; */
      border-radius: 50%;
      transform: translateY(-100%); /* Start completely above the planet */
      transition: transform 0.3s ease-out; /* Smooth transition */
      pointer-events: none; /* Don't block clicks on the planet */
    }

    #earth-eyelid.password-active {
      transform: translateY(0%); /* Move down to cover the planet */
    }

    /* Styles for the new header buttons */
    .header-btn {
      background-color: #0a143e;
      color: #56d9f9;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      transition: background-color 0.3s ease, box-shadow 0.3s ease, color 0.3s ease;
      cursor: pointer;
      border: 1px solid #1e293b;
      white-space: nowrap; /* Prevent text wrapping */
    }
    .header-btn:hover {
      background-color: #1e40af;
      color: white;
      box-shadow: 0 0 10px #3b82f6;
    }
    .header-btn:focus-visible {
      outline: 2px solid #56d9f9;
      outline-offset: 2px;
    }

    /* Simulation Tool Styles */
    #simulation-tool {
      display: none; /* Hidden by default */
      max-width: 1200px;
      margin: 2rem auto 4rem;
      padding: 2rem;
      background: rgba(5, 14, 38, 0.85);
      border-radius: 1rem;
      box-shadow: 0 0 20px #56d9f9;
      color: white;
      text-align: center;
    }

    #simulation-tool h2 {
      font-size: 2.5rem;
      color: #56d9f9;
      margin-bottom: 1.5rem;
    }

    #simulation-tool .input-group {
      margin-bottom: 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #simulation-tool label {
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
      color: #a0e7e5;
    }

    #simulation-tool input[type="number"],
    #simulation-tool select {
      width: 80%;
      max-width: 300px;
      padding: 0.75rem;
      border-radius: 0.5rem;
      border: 1px solid #2c3b62;
      background-color: #050e26;
      color: #cbd5e1;
      font-size: 1rem;
    }

    #simulation-tool button {
      margin-top: 1.5rem;
      background-color: #3b82f6;
      color: white;
      padding: 0.75rem 2rem;
      border-radius: 0.5rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      cursor: pointer;
      box-shadow: 0 0 10px #3b82f6;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }

    #simulation-tool button:hover {
      background-color: #2563eb;
      box-shadow: 0 0 15px #2563eb;
    }

    #simulation-results {
      margin-top: 2rem;
      padding: 1.5rem;
      background-color: rgba(11, 23, 50, 0.6);
      border-radius: 0.75rem;
      border: 1px solid #2c3b62;
      box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
      text-align: left;
    }

    #simulation-results h3 {
      font-size: 1.8rem;
      color: #56d9f9;
      margin-bottom: 1rem;
    }

    #simulation-results p {
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
    }

    #simulation-results p span {
      font-weight: 600;
      color: #fbbf24;
    }

  </style>
</head>
<body class="flex flex-col min-h-screen logged-out">

  <!-- Top Navigation -->
  <header class="w-full px-6 py-4 flex justify-between items-center border-b border-indigo-800 rounded-b-md rounded-t-none">
    <h1 id="main-title" class="text-white text-3xl font-extrabold tracking-widest select-none drop-shadow-[0_0_10px_rgba(86,217,249,0.9)]">THE FINAL SMASHERS</h1>
    
    <!-- New Buttons Container -->
    <div class="flex items-center gap-4 ml-auto mr-4"> <!-- Added ml-auto to push to right, mr-4 for spacing -->
        <button class="header-btn" id="simulation-tool-btn">Simulation Tool</button>
        <button class="header-btn" id="asteroid-map-btn">Asteroid Map</button>
        <button class="header-btn" id="mitigation-map-btn">Mitigation Map</button>
    </div>

    <div id="auth-controls" class="flex items-center gap-4">
        <div id="user-info" style="display: none;">
            <span>Welcome, <span id="display-username"></span> (<span id="display-role"></span>)</span>
            <button id="logout-btn">Logout</button>
        </div>
        <button id="login-signup-btn">Login / Sign Up</button>
    </div>
  </header>

  <div id="main-content-wrapper">
    <main>
      <!-- Hero Section (Main Page) -->
      <section id="hero-section" class="rounded-container mx-6 my-6 p-8 flex flex-col md:flex-row items-center gap-8 md:gap-16 shadow-lg select-none">
        <!-- Left Text Content -->
        <div class="flex-1 max-w-3xl text-center md:text-left">
          <h2 class="text-white drop-shadow-[0_0_10px_rgba(86,217,249,0.9)] text-4xl md:text-5xl font-extrabold leading-tight tracking-wide uppercase">
            Explore<br />
            <span class="text-cyan-400">Asteroids</span> and<br />
            Potential Impacts
          </h2>
          <button id="learn-more-btn" aria-label="Wanna go further?" 
            class="learn-more-btn mt-8 text-white shadow-md shadow-cyan-700 hover:shadow-cyan-400 focus-visible:ring-4 focus-visible:ring-cyan-400 focus-visible:ring-opacity-70">
            Wanna Go Further?
          </button>
        </div>

        <!-- Right Space Illustration (Main Page Card) -->
        <div class="flex-1 max-w-lg w-full relative rounded-lg overflow-hidden shadow-xl" aria-hidden="true">
          <img 
            src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/4d1b89f0-b78f-406e-876c-ac7dade91311.png"
            alt="Digital art showing asteroid floating near earth, a fiery comet in space with glowing stars and deep blue space background, with an orange impact glow on Earth's surface"
            onerror="this.style.display='none';"
          />
        </div>
      </section>

      <!-- NEW ASTEROID UNDER STUDY SECTION (Main Page Card) -->
      <section class="new-asteroid-container select-none" aria-label="New Asteroid Under Study Information">
        <div class="new-asteroid-content">
          <h1><span>NEW ASTEROID</span><br>UNDER STUDY</h1>
          <div class="asteroid-id">2025VX1 (IMPACTOR 2025)</div>
          <div class="details">
            <p><span>Location:</span> under study</p>
            <p><span>Estimated Size:</span> 500 meters in diameter</p>
            <p><span>Potential Impact:</span> may produce cataclysmic effects like tremendous shockwaves, tsunamis, and worldwide climatic disruption from the sun's blockage due to dust and debris.</p>
          </div>
        </div>

        <div class="image-container">
          <img src="https://i.postimg.cc/NjC314vh/understudy.png" alt="Asteroid" />
        </div>
      </section>

      <!-- Info Cards Section (empty) - hidden on main page -->
      <section id="info-cards" class="mx-6 mb-6 grid grid-cols-1 sm:grid-cols-1 gap-6 select-none" style="display:none;">
      </section>

      <!-- Second Page Section - Initially Hidden -->
      <section id="second-page" class="mx-6 mb-10 select-none" aria-label="Further Asteroids">
        <header class="text-center mb-10">
          <h1 id="second-page-title" class="text-white text-4xl font-extrabold tracking-widest drop-shadow-[0_0_12px_rgba(86,217,249,0.85)] uppercase">FURTHER ASTEROIDS</h1>
          <p class="text-cyan-400 text-lg tracking-wide mt-1 font-semibold">THE COSMIC IMPACT EXPLORER</p>
        </header>
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6 max-w-7xl mx-auto" id="second-page-cards">

          <article class="card flex flex-col items-center p-4 text-white shadow-lg" data-asteroid="Apophis">
            <div class="card-image-wrapper">
              <img src="https://i.ibb.co/Ndq9mRH6/apophiss.png" alt="3D dark cratered asteroid named Apophis shown in cool blue lighting" onerror="this.style.display='none';" />
              <div class="card-hover-overlay" aria-hidden="true">
                <button class="card-hover-btn" type="button">wanna know more ?</button>
              </div>
            </div>
            <h3 class="mt-3 text-xl font-bold">Apophis</h3>
          </article>

          <article class="card flex flex-col items-center p-4 text-white shadow-lg" data-asteroid="Eros">
            <div class="card-image-wrapper">
              <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/54676d36-b852-4f0e-8ac4-37f6b003aa2b.png" alt="3D asteroid named Eros textured with rough surfaces shown in deep blue lighting" onerror="this.style.display='none';" />
              <div class="card-hover-overlay" aria-hidden="true">
                <button class="card-hover-btn" type="button">wanna know more ?</button>
              </div>
            </div>
            <h3 class="mt-3 text-xl font-bold">Eros</h3>
          </article>

          <article class="card flex flex-col items-center p-4 text-white shadow-lg" data-asteroid="Vesta">
            <div class="card-image-wrapper">
              <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/3dfa444d-a26d-40e3-84d2-02a93bb11e1f.png" alt="3D cratered asteroid named Vesta illuminated with soft blue light" onerror="this.style.display='none';" />
              <div class="card-hover-overlay" aria-hidden="true">
                <button class="card-hover-btn" type="button">wanna know more ?</button>
              </div>
            </div>
            <h3 class="mt-3 text-xl font-bold">Vesta</h3>
          </article>

          <article class="card flex flex-col items-center p-4 text-white shadow-lg" data-asteroid="Hygeia">
            <div class="card-image-wrapper">
              <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/ef2a70bd-3b18-43f1-bfee-cc64cd8d19e6.png" alt="3D asteroid named Hygeia with a rocky texture and blue tone lighting" onerror="this.style.display='none';" />
              <div class="card-hover-overlay" aria-hidden="true">
                <button class="card-hover-btn" type="button">wanna know more ?</button>
              </div>
            </div>
            <h3 class="mt-3 text-xl font-bold">Hygeia</h3>
          </article>

          <article class="card flex flex-col items-center p-4 text-white shadow-lg" data-asteroid="Ganymed">
            <div class="card-image-wrapper">
              <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/d07a3927-b45f-4809-8784-335038a4bc70.png" alt="3D asteroid named Ganymed with a rugged and cratered surface in dark light" onerror="this.style.display='none';" />
              <div class="card-hover-overlay" aria-hidden="true">
                <button class="card-hover-btn" type="button">wanna know more ?</button>
              </div>
            </div>
            <h3 class="mt-3 text-xl font-bold">Ganymed</h3>
          </article>

          <article class="card flex flex-col items-center p-4 text-white shadow-lg" data-asteroid="Pallas">
            <div class="card-image-wrapper">
              <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/15b5384a-8d06-4353-8ac3-b0a1a322e190.png" alt="3D asteroid named Pallas showing rough features illuminated softly in blue" onerror="this.style.display='none';" />
              <div class="card-hover-overlay" aria-hidden="true">
                <button class="card-hover-btn" type="button">wanna know more ?</button>
              </div>
            </div>
            <h3 class="mt-3 text-xl font-bold">Pallas</h3>
          </article>

          <article class="card flex flex-col items-center p-4 text-white shadow-lg" data-asteroid="Itokawa">
            <div class="card-image-wrapper">
              <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/40c72ef7-de95-489b-ba88-ca6a192f6df3.png" alt="3D small asteroid named Itokawa composed of two lobes in blue-tinged light" onerror="this.style.display='none';" />
              <div class="card-hover-overlay" aria-hidden="true">
                <button class="card-hover-btn" type="button">wanna know more ?</button>
              </div>
            </div>
            <h3 class="mt-3 text-xl font-bold">Itokawa</h3>
          </article>

          <article class="card flex flex-col items-center p-4 text-white shadow-lg" data-asteroid="Ceres">
            <div class="card-image-wrapper">
              <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/9a4cbbd4-890a-4863-9ae7-4861caa042fb.png" alt="3D large asteroid named Ceres with smooth surface texture and night sky colors" onerror="this.style.display='none';" />
              <div class="card-hover-overlay" aria-hidden="true">
                <button class="card-hover-btn" type="button">wanna know more ?</button>
              </div>
            </div>
            <h3 class="mt-3 text-xl font-bold">Ceres</h3>
          </article>

        </div>
        <div class="text-center mt-10">
          <button id="back-to-main-btn" aria-label="Back to main page"
            class="learn-more-btn text-white shadow-md shadow-cyan-700 hover:shadow-cyan-400 focus-visible:ring-4 focus-visible:ring-cyan-400 focus-visible:ring-opacity-70">
            Back to the Main Page
          </button>
        </div>
      </section>

      <!-- Third Page Section - Invisible on main page -->
      <section id="third-page" aria-label="Asteroid details" class="select-none" role="region">
        <img id="third-page-image" src="https://upload.wikimedia.org/wikipedia/commons/9/97/The_Earth_seen_from_Apollo_17.jpg" alt="Earth seen from space with background of stars and nebula" />
        <div id="third-page-content">
          <h1 id="third-page-title">
            The Invisible<br />
            <span>Forces</span>
          </h1>
          <p id="third-page-description">
            Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.
          </p>
          <button class="back-btn" type="button" aria-label="Back to asteroids page">Back to Asteroids</button>
        </div>
      </section>

      <!-- Scientist Exclusive Content -->
      <section id="scientist-exclusive-content" class="select-none">
          <h2>Scientist Access Only</h2>
          <p>Welcome, esteemed scientist! Here you can find advanced research data and tools related to cosmic impacts. This section is only visible to users logged in as 'Scientist'.</p>
          <p>Imagine this area filled with interactive charts, real-time tracking, and simulation access.</p>
      </section>

      <!-- Simulation Tool Section -->
      <section id="simulation-tool" class="select-none">
        <h2>Asteroid Impact Simulation Tool</h2>
        <div class="input-group">
          <label for="asteroid-size">Asteroid Diameter (meters):</label>
          <input type="number" id="asteroid-size" value="50" min="1" max="10000">
        </div>
        <div class="input-group">
          <label for="asteroid-velocity">Impact Velocity (km/s):</label>
          <input type="number" id="asteroid-velocity" value="20" min="1" max="50">
        </div>
        <div class="input-group">
          <label for="target-type">Target Surface:</label>
          <select id="target-type">
            <option value="land">Land</option>
            <option value="ocean">Ocean</option>
          </select>
        </div>
        <button id="run-simulation-btn">Run Simulation</button>
        <div id="simulation-results" style="display:none;">
          <h3>Simulation Results</h3>
          <p>Impact Energy: <span id="result-energy"></span></p>
          <p>Crater Diameter: <span id="result-crater"></span></p>
          <p>Ejecta Blanket: <span id="result-ejecta"></span></p>
          <p>Potential Effects: <span id="result-effects"></span></p>
        </div>
      </section>

    </main>
  </div> <!-- End main-content-wrapper -->

  <footer class="w-full text-center py-4 text-gray-500 text-sm select-none border-t border-indigo-800">
    &copy; 2025 The Final Smashers. All rights reserved.
  </footer>

  <!-- Chatbot Button -->
  <button id="chatbot-btn" aria-label="Open chatbot">🤖</button>

  <!-- Chatbot Modal -->
  <div id="chatbot-modal">
      <div id="chatbot-header">
          <h3>Asteroid AI Chatbot</h3>
          <p>Ask me about asteroids!</p>
      </div>
      <div id="chat-messages"></div>
      <div id="chat-input-container">
          <input type="text" id="chat-input" placeholder="Type your asteroid question..." aria-label="Chat input">
          <button id="chat-send-btn" aria-label="Send message">Send</button>
      </div>
  </div>

  <!-- Sign-up/Login Gate Modal -->
  <div id="gate-modal">
      <div id="gate-content">
          <h2 id="gate-title">Login</h2>
          <form id="login-form">
              <!-- Earth Planet Eye -->
              <div id="earth-container">
                  <img id="earth-planet" src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/97/The_Earth_seen_from_Apollo_17.jpg/1024px-The_Earth_seen_from_Apollo_17.jpg" alt="Earth Planet" />
                  <div id="earth-eyelid"></div>
              </div>

              <input type="text" id="login-username" placeholder="Username" required />
              <input type="password" id="login-password" placeholder="Password" required />
              <div id="login-message" class="text-red-500 text-sm mt-2 min-h-[1.5rem]"></div>
              <button type="submit" class="primary-btn">Login</button>
              <button type="button" id="show-signup-btn" class="secondary-btn">Don't have an account? Sign Up</button>
          </form>

          <form id="signup-form" style="display: none;">
              <input type="text" id="signup-username" placeholder="Username" required />
              <input type="password" id="signup-password" placeholder="Password" required />
              <select id="signup-role" class="w-full p-3 mb-4 border rounded-lg bg-gray-800 text-white">
                  <option value="normal">public user</option>
                  <option value="scientist">Scientist</option>
              </select>
              <div id="signup-message" class="text-red-500 text-sm mt-2 min-h-[1.5rem]"></div>
              <button type="submit" class="primary-btn">Sign Up</button>
              <button type="button" id="show-login-btn" class="secondary-btn">Already have an account? Login</button>
          </form>
      </div>
  </div>

  <script>
    // Ensure DOM is fully loaded before adding event listeners
    document.addEventListener('DOMContentLoaded', function() {
      // --- Page Navigation Logic (Original) ---
      const heroSection = document.getElementById('hero-section');
      const newAsteroidContainer = document.querySelector('.new-asteroid-container');
      const infoCards = document.getElementById('info-cards');
      const secondPage = document.getElementById('second-page');
      const thirdPage = document.getElementById('third-page');
      const mainTitle = document.getElementById('main-title');
      const footer = document.querySelector('footer');
      const scientistExclusiveContent = document.getElementById('scientist-exclusive-content');
      const simulationTool = document.getElementById('simulation-tool'); // Get simulation tool section

      function hideAllContentSections() {
        heroSection.style.display = 'none';
        newAsteroidContainer.style.display = 'none';
        infoCards.style.display = 'none';
        secondPage.style.display = 'none';
        thirdPage.style.display = 'none';
        scientistExclusiveContent.style.display = 'none';
        simulationTool.style.display = 'none'; // Hide simulation tool
      }

      function showMainPageSections() {
        hideAllContentSections();
        heroSection.style.display = 'flex';
        newAsteroidContainer.style.display = 'flex';
        updateUI(); // Re-evaluate scientist content visibility
      }

      function showSecondPage() {
        hideAllContentSections();
        secondPage.style.display = 'block';
      }

      function showThirdPage(asteroidName) {
        hideAllContentSections();
        thirdPage.style.display = 'flex'; // Third page uses flex
        updateThirdPageContent(asteroidName);
      }

      function showSimulationTool() {
        hideAllContentSections();
        simulationTool.style.display = 'block';
      }

      // Initial state: show main page sections (will be overridden by gate if not logged in)
      // showMainPageSections(); // This will be called after login/initial check

      document.getElementById('learn-more-btn').addEventListener('click', showSecondPage);
      document.getElementById('back-to-main-btn').addEventListener('click', showMainPageSections);
      document.querySelector('#third-page .back-btn').addEventListener('click', showSecondPage);

      // Header button event listeners
      document.getElementById('simulation-tool-btn').addEventListener('click', showSimulationTool);
      document.getElementById('asteroid-map-btn').addEventListener('click', () => {
        alert('Asteroid Map functionality coming soon!');
        // You might want to show a specific section for the map here
        showMainPageSections(); // For now, go back to main
      });
      document.getElementById('mitigation-map-btn').addEventListener('click', () => {
        alert('Mitigation Map functionality coming soon!');
        // You might want to show a specific section for the map here
        showMainPageSections(); // For now, go back to main
      });


      // --- Asteroid Details Data ---
      const asteroidDetails = {
        "Apophis": {
          title: "Apophis",
          image: "https://i.ibb.co/Ndq9mRH6/apophiss.png",
          description: `Classification: Near‑Earth Object (NEO), Potentially Hazardous Asteroid (PHA).
Size & Shape: elongated, irregular; effective diameter ~330–375 m; long axis ~450 m (from radar/thermal models).
Rotation: non‑principal‑axis (tumbling) rotation; ~30.5 hours.
Closest Approach: April 13, 2029 — ~32,000–38,000 km (closer than geostationary orbit).
Risk: No impact risk for at least 100 years based on updated orbital solutions.
Science: Close flyby offers rare opportunity for detailed characterization; multiple missions and observing campaigns planned.

Nicknamed after the Egyptian god of chaos (fitting, right?).
In 2004, scientists thought it might hit Earth on Friday, April 13, 2029.
Size: ~450 meters long — bigger than the Empire State Building laid sideways.
Will pass closer than some satellites — just 20,000 miles above Earth.
NASA's OSIRIS-APEX spacecraft is en route to meet it after the flyby (a 'cosmic handshake').`
        },
        "Eros": {
          title: "Eros",
          image: "https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/54676d36-b852-4f0e-8ac4-37f6b003aa2b.png",
          description: `Eros is a large S-type asteroid, the second-largest Near-Earth Object (NEO) after Ganymed. It was the first asteroid to be orbited and landed on by a spacecraft (NEAR Shoemaker in 2000-2001). It is an elongated, peanut-shaped asteroid, approximately 34.4 km long. Its surface is heavily cratered, with some smooth areas. Eros is a significant object of study due to its proximity to Earth and its potential as a resource for future space missions.`
        },
        "Vesta": {
          title: "Vesta",
          image: "https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/3dfa444d-a26d-40e3-84d2-02a93bb11e1f.png",
          description: `Vesta is the second-most massive asteroid in the asteroid belt, with an average diameter of about 525 kilometers. It is unique among asteroids for having a differentiated interior, similar to terrestrial planets, with a core, mantle, and crust. Vesta is the parent body of the HED meteorites, which are thought to originate from its surface. NASA's Dawn spacecraft orbited Vesta from 2011 to 2012, providing detailed images and data.`
        },
        "Hygeia": {
          title: "Hygeia",
          image: "https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/ef2a70bd-3b18-43f1-bfee-cc64cd8d19e6.png",
          description: `Hygeia is the fourth-largest asteroid in the main asteroid belt, with a diameter of about 430 kilometers. It is a C-type asteroid, meaning it is carbonaceous and primitive in composition. Recent observations suggest that Hygeia is nearly spherical, making it a strong candidate for reclassification as a dwarf planet, similar to Ceres. It is thought to be the largest member of the Hygiea family of asteroids.`
        },
        "Ganymed": {
          title: "Ganymed",
          image: "https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/d07a3927-b45f-4809-8784-335038a4bc70.png",
          description: `Ganymed (not to be confused with Jupiter's moon Ganymede) is a large S-type asteroid and one of the largest Near-Earth Objects (NEOs), with a diameter of about 32 kilometers. It is a member of the Amor group of asteroids, which cross Mars's orbit but do not cross Earth's orbit. Ganymed is a target of interest for radar observations due to its size and relatively close approaches to Earth.`
        },
        "Pallas": {
          title: "Pallas",
          image: "https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/15b5384a-8d06-4353-8ac3-b0a1a322e190.png",
          description: `Pallas is the second-largest asteroid by mass in the asteroid belt, with a diameter of about 512 kilometers. It is a B-type asteroid, characterized by a primitive, carbonaceous composition. Pallas has a highly inclined and eccentric orbit, making it difficult to study. Despite its size, its irregular shape and surface features are still being investigated.`
        },
        "Itokawa": {
          title: "Itokawa",
          image: "https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/40c72ef7-de95-489b-ba88-ca6a192f6df3.png",
          description: `Itokawa is a small, S-type Near-Earth Asteroid (NEA) with an irregular, "peanut-shaped" form, approximately 535 meters long. It was the first asteroid from which samples were returned to Earth by the Japanese Hayabusa spacecraft in 2010. Studies of these samples have provided invaluable insights into the composition and structure of asteroids, revealing it to be a rubble pile asteroid.`
        },
        "Ceres": {
          title: "Ceres",
          image: "https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/9a4cbbd4-890a-4863-9ae7-4861caa042fb.png",
          description: `Ceres is the largest object in the asteroid belt, with a diameter of about 940 kilometers, and is classified as a dwarf planet. It is the only dwarf planet in the inner solar system. NASA's Dawn spacecraft orbited Ceres from 2015 to 2018, revealing a heavily cratered surface, bright spots (likely salt deposits), and evidence of water ice and cryovolcanism. Ceres is considered a protoplanet and a remnant from the early solar system.`
        }
      };

      function updateThirdPageContent(asteroidName) {
        const data = asteroidDetails[asteroidName];
        if (data) {
          document.getElementById('third-page-title').innerHTML = data.title.split(' ')[0] + '<br /><span>' + data.title.split(' ').slice(1).join(' ') + '</span>';
          document.getElementById('third-page-image').src = data.image;
          document.getElementById('third-page-image').alt = `Image of ${data.title}`;
          document.getElementById('third-page-description').textContent = data.description;
        } else {
          // Fallback for unknown asteroids
          document.getElementById('third-page-title').innerHTML = 'Unknown<br /><span>Asteroid</span>';
          document.getElementById('third-page-image').src = 'https://upload.wikimedia.org/wikipedia/commons/9/97/The_Earth_seen_from_Apollo_17.jpg'; // Default image
          document.getElementById('third-page-image').alt = 'Default asteroid image';
          document.getElementById('third-page-description').textContent = 'Details for this asteroid are not available yet.';
        }
      }

      const knowMoreButtons = document.querySelectorAll('.card-hover-btn');
      knowMoreButtons.forEach(btn => {
        btn.addEventListener('click', (event) => {
          const card = event.target.closest('.card');
          const asteroidName = card.dataset.asteroid;
          showThirdPage(asteroidName);
        });
      });

      // --- Chatbot Logic ---
      const chatbotBtn = document.getElementById('chatbot-btn');
      const chatbotModal = document.getElementById('chatbot-modal');
      const chatMessages = document.getElementById('chat-messages');
      const chatInput = document.getElementById('chat-input');
      const chatSendBtn = document.getElementById('chat-send-btn');

      const asteroidKnowledge = {
        "new asteroid": "The new asteroid under study is 2025VX1, also known as IMPACTOR 2025.",
        "2025vx1": "Asteroid 2025VX1 (IMPACTOR 2025) is currently under study. Its estimated size is 500 meters in diameter.",
        "impactor 2025": "IMPACTOR 2025 (2025VX1) is an asteroid under study, estimated to be 500 meters in diameter.",
        "size of 2025vx1": "The estimated size of asteroid 2025VX1 is 500 meters in diameter.",
        "potential impact of 2025vx1": "The potential impact of 2025VX1 may produce cataclysmic effects like tremendous shockwaves, tsunamis, and worldwide climatic disruption from the sun's blockage due to dust and debris.",
        "apophis": asteroidDetails["Apophis"].description, // Use the detailed description
        "eros": asteroidDetails["Eros"].description,
        "vesta": asteroidDetails["Vesta"].description,
        "hygeia": asteroidDetails["Hygeia"].description,
        "ganymed": asteroidDetails["Ganymed"].description,
        "pallas": asteroidDetails["Pallas"].description,
        "itokawa": asteroidDetails["Itokawa"].description,
        "ceres": asteroidDetails["Ceres"].description,
        "what are asteroids": "Asteroids are rocky objects that orbit the Sun. This explorer focuses on potential impacts.",
        "cosmic impact explorer": "The Cosmic Impact Explorer is a platform to explore asteroids and potential impacts.",
        "the final smashers": "The Final Smashers is the name of the entity behind this Cosmic Impact Explorer.",
        "invisible forces": "The 'Invisible Forces' section discusses general concepts, but the specific content is placeholder text (Lorem ipsum).",
        "default": "I can only answer questions related to the asteroids mentioned on this website (e.g., 2025VX1, Apophis, Eros, etc.) or general information presented here. Please ask about a specific asteroid or topic from the page."
      };

      chatbotBtn.addEventListener('click', () => {
        chatbotModal.style.display = chatbotModal.style.display === 'flex' ? 'none' : 'flex';
        if (chatbotModal.style.display === 'flex') {
          chatInput.focus();
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }
      });

      function addMessage(text, sender) {
        const msgDiv = document.createElement('div');
        msgDiv.className = `message ${sender}`;
        msgDiv.textContent = text;
        chatMessages.appendChild(msgDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      function getAIResponse(userMessage) {
        const lowerMsg = userMessage.toLowerCase();
        let response = asteroidKnowledge.default;

        for (const keyword in asteroidKnowledge) {
          if (lowerMsg.includes(keyword.toLowerCase())) { // Case-insensitive matching
            response = asteroidKnowledge[keyword];
            break;
          }
        }
        return response;
      }

      function sendMessage() {
        const userText = chatInput.value.trim();
        if (userText === '') return;

        addMessage(userText, 'user');
        chatInput.value = '';

        setTimeout(() => {
          const botResponse = getAIResponse(userText);
          addMessage(botResponse, 'bot');
        }, 700);
      }

      chatSendBtn.addEventListener('click', sendMessage);
      chatInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          sendMessage();
        }
      });

      // --- Authentication Gate Logic ---
      const gateModal = document.getElementById('gate-modal');
      const loginForm = document.getElementById('login-form');
      const signupForm = document.getElementById('signup-form');
      const showSignupBtn = document.getElementById('show-signup-btn');
      const showLoginBtn = document.getElementById('show-login-btn');
      const loginSignupBtn = document.getElementById('login-signup-btn');
      const logoutBtn = document.getElementById('logout-btn');
      const userInfoDiv = document.getElementById('user-info');
      const displayUsernameSpan = document.getElementById('display-username');
      const displayRoleSpan = document.getElementById('display-role');
      const mainContentWrapper = document.getElementById('main-content-wrapper');
      const body = document.body;

      let users = JSON.parse(localStorage.getItem('users')) || {};
      let currentUser = JSON.parse(localStorage.getItem('currentUser'));

      function updateUI() {
        if (currentUser) {
          body.classList.remove('logged-out');
          mainContentWrapper.style.display = 'block'; // Show main content
          loginSignupBtn.style.display = 'none';
          userInfoDiv.style.display = 'flex';
          displayUsernameSpan.textContent = currentUser.username;
          displayRoleSpan.textContent = currentUser.role === 'scientist' ? 'Scientist' : 'Public User';
          chatbotBtn.style.display = 'flex'; // Show chatbot

          // Show scientist-exclusive content ONLY if role is scientist AND we are on the main page view
          if (currentUser.role === 'scientist' &&
              heroSection.style.display !== 'none' &&
              newAsteroidContainer.style.display !== 'none' &&
              secondPage.style.display === 'none' &&
              thirdPage.style.display === 'none' &&
              simulationTool.style.display === 'none' // Also check simulation tool
              ) {
            scientistExclusiveContent.style.display = 'block';
          } else {
            scientistExclusiveContent.style.display = 'none';
          }
        } else {
          body.classList.add('logged-out');
          mainContentWrapper.style.display = 'none'; // Hide main content
          loginSignupBtn.style.display = 'block';
          userInfoDiv.style.display = 'none';
          chatbotBtn.style.display = 'none'; // Hide chatbot
          scientistExclusiveContent.style.display = 'none'; // Hide scientist content
        }
      }

      function showGate(formType = 'login') {
        gateModal.style.display = 'flex';
        if (formType === 'login') {
          document.getElementById('gate-title').textContent = 'Login';
          loginForm.style.display = 'block';
          signupForm.style.display = 'none';
          document.getElementById('login-message').textContent = '';
          document.getElementById('login-username').value = '';
          document.getElementById('login-password').value = '';
        } else {
          document.getElementById('gate-title').textContent = 'Sign Up';
          loginForm.style.display = 'none';
          signupForm.style.display = 'block';
          document.getElementById('signup-message').textContent = '';
          document.getElementById('signup-username').value = '';
          document.getElementById('signup-password').value = '';
          document.getElementById('signup-role').value = 'normal';
        }
      }

      function hideGate() {
        gateModal.style.display = 'none';
      }

      // Event Listeners for Gate
      loginSignupBtn.addEventListener('click', () => showGate('login'));
      logoutBtn.addEventListener('click', () => {
        currentUser = null;
        localStorage.removeItem('currentUser');
        updateUI();
        showGate('login'); // Show login gate after logout
      });

      showSignupBtn.addEventListener('click', (e) => {
        e.preventDefault(); // Prevent form submission if it's a button inside a form
        showGate('signup');
      });
      showLoginBtn.addEventListener('click', (e) => {
        e.preventDefault(); // Prevent form submission if it's a button inside a form
        showGate('login');
      });

      loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const username = document.getElementById('login-username').value;
        const password = document.getElementById('login-password').value;
        const loginMessage = document.getElementById('login-message');

        if (users[username] && users[username].password === password) {
          currentUser = { username: username, role: users[username].role };
          localStorage.setItem('currentUser', JSON.stringify(currentUser));
          hideGate();
          updateUI();
          showMainPageSections(); // Ensure main page is shown after login
        } else {
          loginMessage.textContent = 'Invalid username or password.';
        }
      });

      signupForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const username = document.getElementById('signup-username').value;
        const password = document.getElementById('signup-password').value;
        const role = document.getElementById('signup-role').value;
        const signupMessage = document.getElementById('signup-message');

        if (users[username]) {
          signupMessage.textContent = 'Username already exists.';
        } else {
          users[username] = { password: password, role: role };
          localStorage.setItem('users', JSON.stringify(users));
          signupMessage.textContent = 'Sign up successful! Please log in.';
          signupMessage.style.color = '#22c55e'; // Green for success
          setTimeout(() => showGate('login'), 1500); // Show login form after signup
        }
      });

      // --- Earth Planet Eye Logic ---
      const loginPasswordInput = document.getElementById('login-password');
      const earthEyelid = document.getElementById('earth-eyelid');

      if (loginPasswordInput && earthEyelid) {
        loginPasswordInput.addEventListener('focus', () => {
          earthEyelid.classList.add('password-active');
        });

        loginPasswordInput.addEventListener('blur', () => {
          earthEyelid.classList.remove('password-active');
        });
      }

      // --- Simulation Tool Logic ---
      const runSimulationBtn = document.getElementById('run-simulation-btn');
      const asteroidSizeInput = document.getElementById('asteroid-size');
      const asteroidVelocityInput = document.getElementById('asteroid-velocity');
      const targetTypeSelect = document.getElementById('target-type');
      const simulationResultsDiv = document.getElementById('simulation-results');
      const resultEnergy = document.getElementById('result-energy');
      const resultCrater = document.getElementById('result-crater');
      const resultEjecta = document.getElementById('result-ejecta');
      const resultEffects = document.getElementById('result-effects');

      runSimulationBtn.addEventListener('click', () => {
        const size = parseFloat(asteroidSizeInput.value); // meters
        const velocity = parseFloat(asteroidVelocityInput.value) * 1000; // km/s to m/s
        const target = targetTypeSelect.value;

        if (isNaN(size) || isNaN(velocity) || size <= 0 || velocity <= 0) {
          alert('Please enter valid positive numbers for asteroid size and velocity.');
          return;
        }

        // Simplified impact physics (for demonstration)
        // Mass (assuming average asteroid density ~2500 kg/m^3)
        // Volume of a sphere: (4/3) * pi * r^3
        const radius = size / 2;
        const volume = (4/3) * Math.PI * Math.pow(radius, 3);
        const density = 2500; // kg/m^3
        const mass = density * volume; // kg

        // Kinetic Energy: 0.5 * m * v^2 (Joules)
        const energyJoules = 0.5 * mass * Math.pow(velocity, 2);
        const energyMegatons = energyJoules / (4.184 * Math.pow(10, 15)); // Convert Joules to Megatons of TNT

        let craterDiameter = 0; // meters
        let ejectaBlanket = '';
        let potentialEffects = '';

        if (target === 'land') {
          // Empirical formula for crater diameter on land (simplified)
          // D ≈ 1.2 * (E / g)^(1/3) where E is energy in Joules, g is gravity (9.8 m/s^2)
          craterDiameter = 1.2 * Math.pow(energyJoules / 9.8, 1/3); // Very rough estimate
          craterDiameter = Math.min(craterDiameter, size * 50); // Cap crater size relative to asteroid for realism
          craterDiameter = Math.max(craterDiameter, size * 5); // Minimum crater size

          if (size < 100) {
            potentialEffects = 'Local damage, small crater, air blast.';
            ejectaBlanket = 'Localized around impact site.';
          } else if (size < 500) {
            potentialEffects = 'Regional devastation, significant crater, seismic activity, dust cloud.';
            ejectaBlanket = 'Extends tens to hundreds of kilometers.';
          } else {
            potentialEffects = 'Global climatic disruption, massive crater, widespread seismic activity, tsunamis (if near coast), long-term atmospheric effects.';
            ejectaBlanket = 'Global distribution of fine dust.';
          }
        } else { // Ocean impact
          // Ocean impacts are more complex, focus on tsunami generation
          craterDiameter = 0; // Transient crater, quickly collapses
          if (size < 100) {
            potentialEffects = 'Large splash, localized waves.';
            ejectaBlanket = 'Water vapor and spray.';
          } else if (size < 500) {
            potentialEffects = 'Significant tsunamis affecting coastal regions, atmospheric steam.';
            ejectaBlanket = 'Widespread water vapor and sea spray.';
          } else {
            potentialEffects = 'Catastrophic mega-tsunamis, global atmospheric effects from steam and salt, potential for climate change.';
            ejectaBlanket = 'Global atmospheric distribution of water and salt.';
          }
        }

        resultEnergy.textContent = `${energyMegatons.toExponential(2)} Megatons of TNT`;
        resultCrater.textContent = `${craterDiameter.toFixed(2)} meters (approximate)`;
        resultEjecta.textContent = ejectaBlanket;
        resultEffects.textContent = potentialEffects;

        simulationResultsDiv.style.display = 'block';
      });


      // Initial check on page load
      updateUI();
      if (!currentUser) {
        showGate('login'); // If not logged in, show the gate immediately
      } else {
        showMainPageSections(); // If already logged in, show main content
      }
    }); // End DOMContentLoaded
  </script>

</body>
</html>
